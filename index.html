<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GIA - Assistente Virtual</title>
  <style>
    * {
      box-sizing: border-box;
      scrollbar-width: thin;
      scrollbar-color: #ccc transparent;
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background-color: #bbb;
      border-radius: 3px;
    }

    body {
      margin: 0;
      background-color: #f3f4f6;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    header {
      background-color: #005580;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      width: 100%;
    }

    .mode-switcher {
      display: flex;
      justify-content: center;
      padding: 1rem;
      gap: 1rem;
    }

    .mode-btn {
      padding: 8px 20px;
      border: 2px solid #005580;
      background: white;
      color: #005580;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }

    .mode-btn.active {
      background: #005580;
      color: white;
    }

    .mode-btn:hover {
      background: #004060;
      color: white;
    }

    /* Chat Mode */
    #chat-mode {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 120px);
    }

    #chat-container {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      padding-bottom: 90px;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
    }

    .msg-wrapper {
      display: flex;
      margin-bottom: 12px;
      align-items: flex-start;
    }

    .msg {
      padding: 12px 16px;
      border-radius: 16px;
      line-height: 1.4;
      max-width: 75%;
      word-wrap: break-word;
      background-color: #fff;
    }

    .user-msg {
      align-self: flex-end;
      background-color: #cce5ff;
      color: #00334d;
      border-top-right-radius: 0;
      margin-left: auto;
    }

    .bot-msg {
      background-color: #ffffff;
      border: 1px solid #ccc;
      color: #000;
      border-top-left-radius: 0;
      margin-right: auto;
    }

    .bot-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-color: #005580;
      color: white;
      font-weight: bold;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      flex-shrink: 0;
    }

    #formulario {
      display: flex;
      padding: 0.75rem;
      background-color: white;
      width: 100%;
      max-width: 600px;
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      border-top: 1px solid #ddd;
    }

    #pergunta {
      flex: 1;
      padding: 10px 14px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 999px;
      margin-right: 10px;
    }

    button {
      padding: 10px 16px;
      font-size: 1rem;
      background-color: #005580;
      color: white;
      border: none;
      border-radius: 999px;
      cursor: pointer;
    }

    /* Search Mode */
    #search-mode {
      display: none;
      padding: 1rem;
      max-width: 800px;
      margin: 0 auto;
      width: 100%;
    }

    .search-form {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      font-size: 0.9rem;
      color: #333;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .form-group input,
    .form-group select {
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #005580;
    }

    .dimension-group {
      background: #f8f9fa;
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
    }

    .dimension-group h3 {
      margin: 0 0 1rem 0;
      color: #005580;
      font-size: 1.1rem;
    }

    .search-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
      justify-content: center;
    }

    .search-btn {
      padding: 12px 32px;
      background: #005580;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: background 0.3s;
    }

    .search-btn:hover {
      background: #004060;
    }

    .clear-btn {
      padding: 12px 32px;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: background 0.3s;
    }

    .clear-btn:hover {
      background: #5a6268;
    }

    .results-section {
      margin-top: 2rem;
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: none;
    }

    .result-item {
      border: 1px solid #e0e0e0;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
    }

    .result-item h4 {
      margin: 0 0 0.5rem 0;
      color: #005580;
    }

    @media (max-width: 600px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .search-buttons {
        flex-direction: column;
      }
      
      .search-btn, .clear-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>

  <header>GIA - Assistente Virtual de Ferramentaria</header>

  <div class="mode-switcher">
    <button class="mode-btn active" onclick="switchMode('chat')">üí¨ Chat</button>
    <button class="mode-btn" onclick="switchMode('search')">üîç Busca Avan√ßada</button>
  </div>

  <!-- Chat Mode -->
  <div id="chat-mode">
    <div id="chat-container"></div>
    <form id="formulario" onsubmit="enviarPergunta(); return false;">
      <input type="text" id="pergunta" placeholder="Digite sua pergunta..." autocomplete="off" />
      <button type="submit">‚û§</button>
    </form>
  </div>

  <!-- Search Mode -->
  <div id="search-mode">
    <div class="search-form">
      <h2 style="margin-top: 0; color: #005580;">Busca Estruturada de Ferramentas</h2>
      
      <div class="form-grid">
        <div class="form-group">
          <label for="tipo_ferramenta">Tipo de Ferramenta</label>
          <select id="tipo_ferramenta">
            <option value="">Selecione...</option>
            <option value="Broca">Broca</option>
            <option value="Fresa">Fresa</option>
            <option value="Macho M√°quina">Macho M√°quina</option>
            <option value="Macho Laminador">Macho Laminador</option>
            <option value="Alargador">Alargador</option>
            <option value="Chanfrador">Chanfrador</option>
            <option value="Escareador / Rebarbador">Escareador</option>
            <option value="Bedame Grooving">Bedame</option>
            <option value="Inserto / Pastilha">Inserto/Pastilha</option>
          </select>
        </div>

        <div class="form-group">
          <label for="catalogo">Linha do Cat√°logo</label>
          <select id="catalogo">
            <option value="">Todas</option>
            <option value="Eco-Line">Eco-Line</option>
            <option value="Smart-Line">Smart-Line</option>
            <option value="Advanced-Line">Advanced-Line</option>
          </select>
        </div>

        <div class="form-group">
          <label for="material_usinado">Material a Usinar</label>
          <select id="material_usinado">
            <option value="">Selecione...</option>
            <option value="aco">A√ßo</option>
            <option value="inox">A√ßo Inoxid√°vel</option>
            <option value="ferro_fundido">Ferro Fundido</option>
            <option value="aluminio">Alum√≠nio</option>
            <option value="cobre">Cobre</option>
            <option value="metais_nao_ferrosos">Metais N√£o Ferrosos</option>
            <option value="superligas">Superligas</option>
            <option value="materiais_endurecidos">Materiais Endurecidos</option>
          </select>
        </div>

        <div class="form-group">
          <label for="material_ferramenta">Material da Ferramenta</label>
          <select id="material_ferramenta">
            <option value="">Selecione...</option>
            <option value="HSS">HSS (A√ßo R√°pido)</option>
            <option value="METAL DURO">Metal Duro</option>
            <option value="METAL DURO INTERI√áO">Metal Duro Interi√ßo</option>
            <option value="CER√ÇMICA">Cer√¢mica</option>
            <option value="DIAMANTE">Diamante</option>
            <option value="PCBN">PCBN</option>
          </select>
        </div>

        <div class="form-group">
          <label for="refrigeracao">Refrigera√ß√£o Interna</label>
          <select id="refrigeracao">
            <option value="">Indiferente</option>
            <option value="Sim">Com Refrigera√ß√£o</option>
            <option value="N√£o">Sem Refrigera√ß√£o</option>
          </select>
        </div>

        <div class="form-group">
          <label for="codigo_artigo">C√≥digo do Artigo</label>
          <input type="text" id="codigo_artigo" placeholder="Ex: 211">
        </div>
      </div>

      <div class="dimension-group">
        <h3>Dimens√µes (mm)</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="diametro">Di√¢metro</label>
            <input type="number" id="diametro" step="0.01" placeholder="Ex: 20">
          </div>
          
          <div class="form-group">
            <label for="comprimento_total">Comprimento Total</label>
            <input type="number" id="comprimento_total" step="0.01" placeholder="Ex: 100">
          </div>
          
          <div class="form-group">
            <label for="comprimento_corte">Comprimento de Corte</label>
            <input type="number" id="comprimento_corte" step="0.01" placeholder="Ex: 30">
          </div>
          
          <div class="form-group">
            <label for="comprimento_haste">Comprimento da Haste</label>
            <input type="number" id="comprimento_haste" step="0.01" placeholder="Ex: 10">
          </div>
        </div>
      </div>

      <div class="form-grid" style="margin-top: 1rem;">
        <div class="form-group">
          <label for="tipo_furo">Tipo de Furo</label>
          <select id="tipo_furo">
            <option value="">Selecione...</option>
            <option value="Passante">Passante</option>
            <option value="Cego">Cego</option>
          </select>
        </div>

        <div class="form-group">
          <label for="norma_din">Norma DIN</label>
          <input type="text" id="norma_din" placeholder="Ex: DIN 339">
        </div>
      </div>

      <div class="search-buttons">
        <button type="button" class="search-btn" onclick="buscarFerramentas()">üîç Buscar</button>
        <button type="button" class="clear-btn" onclick="limparFormulario()">üóëÔ∏è Limpar</button>
      </div>
    </div>

    <div id="results-section" class="results-section"></div>
  </div>

  <script>
  const chatContainer = document.getElementById('chat-container');
  let currentMode = 'chat';

  function switchMode(mode) {
    currentMode = mode;
    const chatMode = document.getElementById('chat-mode');
    const searchMode = document.getElementById('search-mode');
    const modeBtns = document.querySelectorAll('.mode-btn');
    
    modeBtns.forEach(btn => btn.classList.remove('active'));
    
    if (mode === 'chat') {
      chatMode.style.display = 'flex';
      searchMode.style.display = 'none';
      modeBtns[0].classList.add('active');
    } else {
      chatMode.style.display = 'none';
      searchMode.style.display = 'block';
      modeBtns[1].classList.add('active');
    }
  }

  function formatarResposta(texto) {
    const linhas = texto.split('\n');
    return linhas.map(linha => {
      if (linha.startsWith('**') && linha.endsWith('**')) {
        return '<strong>' + linha.replace(/\*\*/g, '') + '</strong>';
      } else if (linha.startsWith('Link: http')) {
        const url = linha.replace('Link: ', '').trim();
        return `<a href="${url}" target="_blank">üîó Acessar produto no Webshop</a>`;
      } else if (linha.startsWith('‚Ä¢')) {
        return `<div style="margin-left: 1rem">‚Ä¢ ${linha.substring(1).trim()}</div>`;
      } else {
        return linha;
      }
    }).join('<br>');
  }

  function adicionarMensagem(texto, classe, isBot = false) {
    const wrapper = document.createElement('div');
    wrapper.className = 'msg-wrapper';

    if (isBot) {
      const avatar = document.createElement('div');
      avatar.className = 'bot-avatar';
      avatar.textContent = 'G';
      wrapper.appendChild(avatar);
    }

    const msg = document.createElement('div');
    msg.className = `msg ${classe}`;
    msg.innerHTML = isBot ? formatarResposta(texto) : texto;
    wrapper.appendChild(msg);
    
    chatContainer.appendChild(wrapper);
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }

  async function enviarPergunta(perguntaManual = null) {
    const input = document.getElementById('pergunta');
    const pergunta = perguntaManual || input.value.trim();
    if (!pergunta) return;

    adicionarMensagem(pergunta, 'user-msg');
    input.value = '';

    const wrapper = document.createElement('div');
    wrapper.className = 'msg-wrapper';

    const avatar = document.createElement('div');
    avatar.className = 'bot-avatar';
    avatar.textContent = 'G';

    const bolha = document.createElement('div');
    bolha.className = 'msg bot-msg';
    bolha.textContent = '...';

    wrapper.appendChild(avatar);
    wrapper.appendChild(bolha);
    chatContainer.appendChild(wrapper);
    chatContainer.scrollTop = chatContainer.scrollHeight;

    try {
      const response = await fetch("https://gia3.onrender.com/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question: pergunta })
      });

      if (!response.ok) throw new Error(`HTTP ${response.status}`);

      const data = await response.json();
      bolha.innerHTML = formatarResposta(data.answer || "N√£o entendi sua pergunta.");

    } catch (error) {
      console.error("Erro:", error);
      bolha.textContent = "Erro ao obter resposta da GIA.";
    }
  }

  function limparFormulario() {
    document.getElementById('tipo_ferramenta').value = '';
    document.getElementById('catalogo').value = '';
    document.getElementById('material_usinado').value = '';
    document.getElementById('material_ferramenta').value = '';
    document.getElementById('refrigeracao').value = '';
    document.getElementById('codigo_artigo').value = '';
    document.getElementById('diametro').value = '';
    document.getElementById('comprimento_total').value = '';
    document.getElementById('comprimento_corte').value = '';
    document.getElementById('comprimento_haste').value = '';
    document.getElementById('tipo_furo').value = '';
    document.getElementById('norma_din').value = '';
    document.getElementById('results-section').style.display = 'none';
  }

  async function buscarFerramentas() {
    const resultSection = document.getElementById('results-section');
    resultSection.innerHTML = '<p>Buscando...</p>';
    resultSection.style.display = 'block';

    // Construir a query baseada nos campos preenchidos
    let queryParts = [];
    
    const tipo = document.getElementById('tipo_ferramenta').value;
    if (tipo) queryParts.push(tipo);
    
    const material = document.getElementById('material_usinado').value;
    if (material) {
      const materialMap = {
        'aco': 'para a√ßo',
        'inox': 'para a√ßo inoxid√°vel',
        'ferro_fundido': 'para ferro fundido',
        'aluminio': 'para alum√≠nio',
        'cobre': 'para cobre',
        'metais_nao_ferrosos': 'para metais n√£o ferrosos',
        'superligas': 'para superligas',
        'materiais_endurecidos': 'para materiais endurecidos'
      };
      queryParts.push(materialMap[material]);
    }
    
    const materialFerramenta = document.getElementById('material_ferramenta').value;
    if (materialFerramenta) queryParts.push(`de ${materialFerramenta}`);
    
    const diametro = document.getElementById('diametro').value;
    if (diametro) queryParts.push(`di√¢metro ${diametro}mm`);
    
    const comprimentoCorte = document.getElementById('comprimento_corte').value;
    if (comprimentoCorte) queryParts.push(`comprimento de corte ${comprimentoCorte}mm`);
    
    const refrigeracao = document.getElementById('refrigeracao').value;
    if (refrigeracao === 'Sim') queryParts.push('com refrigera√ß√£o interna');
    if (refrigeracao === 'N√£o') queryParts.push('sem refrigera√ß√£o');
    
    const codigo = document.getElementById('codigo_artigo').value;
    if (codigo) {
      queryParts = [`artigo ${codigo}`];
    }
    
    const query = queryParts.join(' ') || 'ferramentas dispon√≠veis';

    try {
      const response = await fetch("https://gia3.onrender.com/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question: query })
      });

      if (!response.ok) throw new Error(`HTTP ${response.status}`);

      const data = await response.json();
      resultSection.innerHTML = '<h3>Resultados da Busca:</h3>' + formatarResposta(data.answer);

    } catch (error) {
      console.error("Erro:", error);
      resultSection.innerHTML = '<p style="color: red;">Erro ao buscar ferramentas. Tente novamente.</p>';
    }
  }

  // Adicionar evento Enter no campo de c√≥digo
  document.getElementById('codigo_artigo').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      buscarFerramentas();
    }
  });
  </script>

</body>
</html>
